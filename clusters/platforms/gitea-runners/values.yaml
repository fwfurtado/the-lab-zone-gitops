runner:
  replicas: 2

  image:
    repository: docker.gitea.com/act_runner
    tag: "0.2.13"
    pullPolicy: IfNotPresent

  gitea:
    url: http://gitea-http.gitea.svc.cluster.local:3000
    existingSecret: gitea-runner-token
    existingSecretKey: token

  config:
    log:
      level: info
    runner:
      capacity: 2
      timeout: 1h
      fetch_timeout: 5s
      fetch_interval: 2s
      labels:
        - "ubuntu-latest:docker://ghcr.io/catthehacker/ubuntu:act-latest"
        - "ubuntu-22.04:docker://ghcr.io/catthehacker/ubuntu:act-22.04"
    cache:
      enabled: true
      external_server: "http://gha-cache-server.gitea-runners.svc.cluster.local:3000/"
    container:
      network: ""
      privileged: true
      docker_host: unix:///var/run/docker.sock
      force_pull: true
      force_rebuild: false
      valid_volumes: []

  resources:
    requests:
      cpu: 200m
      memory: 512Mi
    limits:
      cpu: "2"
      memory: 2Gi

  persistence:
    size: 2Gi
    storageClass: truenas-nfs

  # DinD sidecar
  dind:
    # MTU must match pod network (Cilium VXLAN = 1450)
    mtu: 1450
    dns:
      - "1.1.1.1"
      - "8.8.8.8"
    image:
      repository: docker
      tag: "28.3.3-dind"
      pullPolicy: IfNotPresent
    resources:
      requests:
        cpu: 500m
        memory: 512Mi
      limits:
        cpu: "2"
        memory: 2Gi
    # Storage: uses emptyDir (local node disk) for performance.
    # NFS is too slow for Docker's small-file metadata operations.
    # Images are re-pulled on pod restart â€” acceptable trade-off.

cacheServer:
  image:
    repository: ghcr.io/falcondev-oss/github-actions-cache-server
    tag: "8.1.4"
  replicas: 1
  port: 3000
  env:
    STORAGE_DRIVER: s3
    STORAGE_S3_BUCKET: actions-cache
    AWS_REGION: garage
    AWS_S3_FORCE_PATH_STYLE: "true"
    ENABLE_DIRECT_DOWNLOADS: "true"
    CACHE_CLEANUP_OLDER_THAN_DAYS: "30"
  s3SecretName: gha-cache-s3-credentials
  persistence:
    size: 5Gi
    storageClass: truenas-nfs
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 256Mi